---
import BaseLayout from './BaseLayout.astro';
import Nav from '../components/Nav.astro';
import Footer from '../components/Footer.astro';
import Hero from '../components/Hero.astro';
import Breadcrumb from '../components/Breadcrumb.astro';
import TableOfContents from '../components/TableOfContents.astro';
import ContactCTA from '../components/ContactCTA.astro';
import SchemaOrg from '../components/SchemaOrg.astro';

interface Props {
  frontmatter: {
    title: string;
    h1: string;
    description: string;
    keywords: string;
    canonical: string;
    heroImage: string;
    heroSubtitle: string;
    schema: Record<string, unknown>;
    breadcrumbLabel: string;
  };
  headings: { text: string; slug: string; depth: number }[];
}

const { frontmatter, headings } = Astro.props;

const tocHeadings = headings
  .filter(h => h.depth === 2 || h.depth === 3)
  .map(h => ({ text: h.text, id: h.slug, depth: h.depth }));
---

<BaseLayout
  title={frontmatter.title}
  description={frontmatter.description}
  keywords={frontmatter.keywords}
  canonical={frontmatter.canonical}
>
    <SchemaOrg schema={frontmatter.schema} slot="schema" />

    <Nav />

    <Hero
      title={frontmatter.h1}
      subtitle={frontmatter.heroSubtitle}
      ctaText="Kostenlose Erstberatung anfragen"
      ctaHref="#kontakt"
      backgroundImage={frontmatter.heroImage}
    />

    <Breadcrumb items={[
      { label: 'Home', href: '/' },
      { label: frontmatter.breadcrumbLabel },
    ]} />

    {tocHeadings.length > 0 && <TableOfContents headings={tocHeadings} />}

    <article class="max-w-4xl mx-auto px-4 py-12">
        <div class="prose prose-lg max-w-none
            prose-headings:font-serif prose-headings:text-navy
            prose-h2:text-3xl prose-h2:font-bold prose-h2:mt-12 prose-h2:mb-6
            prose-h3:text-2xl prose-h3:font-bold prose-h3:mt-8 prose-h3:mb-4
            prose-p:text-gray-700 prose-p:leading-relaxed prose-p:mb-4
            prose-a:text-navy prose-a:underline hover:prose-a:text-gold
            prose-strong:text-navy
            prose-table:border-collapse prose-th:bg-navy prose-th:text-white prose-th:p-3
            prose-td:border prose-td:border-gray-200 prose-td:p-3
            prose-li:text-gray-700
        ">
            <slot />
        </div>
    </article>

    <ContactCTA />
    <Footer />
</BaseLayout>
